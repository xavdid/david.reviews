---
import { loadMaterializedReads } from "../../airtable/data/reads";
import BookLegend from "../../components/BookLegend.astro";
import BookBox from "../../components/infoboxes/bookbox.astro";
import Layout from "../../layouts/Layout.astro";
import { bookPermalink } from "../../utils";

const rawReviews = await loadMaterializedReads();

const numUniqueBooks = new Set(rawReviews.map((r) => r.book.gbid)).size;
---

<Layout title="Books!" active="books">
  <h1 class="pb-3 pt-2 text-2xl">Every Reviewed Book</h1>
  <p class="pb-3">
    There are {rawReviews.length} total reviews of {numUniqueBooks} books.
  </p>
  <BookLegend />
  <div>
    {
      rawReviews.map((read) => (
        <BookBox
          title={read.book.name}
          slug={read.book.slug}
          rating={read.rating}
          dateFinished={read.dateFinished}
          notes={read.notes}
          isReread={read.isReread}
          googleBooksId={read.book.gbid}
          awardTier={read.book.award?.tier}
          bookMedium={read.medium}
          series={
            read.book.series
              ? {
                  name: read.book.series.name,
                  number: read.book.numberInSeries!,
                }
              : undefined
          }
          authors={read.book.authors}
        />
      ))
    }
  </div>
</Layout>
