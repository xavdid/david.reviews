---
import { loadReads, fields } from "../../airtable/books";
import BookBox from "../../components/infoboxes/bookbox.astro";
import Layout from "../../layouts/Layout.astro";

const rawReviews = await loadReads();

const numUniqueBooks = new Set(rawReviews.map((r) => r[fields.googleBooksId]))
  .size;
---

<Layout title="Books!" active="books">
  <h1 class="pb-3 pt-2 text-2xl">Every Reviewed Book</h1>
  <p class="pb-3">
    There are {rawReviews.length} total reviews of {numUniqueBooks} books.
  </p>
  <!-- <h3 class="pb-2 text-xl">Legend</h3> -->
  <ul class="mb-4 rounded bg-emerald-50 p-2">
    <li>🔈 - Audiobook</li>
    <li>📚 - Part of a Series</li>
    <li>🔁 - Re-read</li>
    <li>
      🥇 / 🥈 / 🥉 - <a
        href="https://xavd.id/blog/tags/yearly-review"
        class="rounded bg-blue-200 p-1 hover:bg-blue-300"
        >Favorite of the Year</a
      > honoree
    </li>
  </ul>
  <div>
    {
      rawReviews.map((review) => (
        <BookBox
          title={review[fields.title][0]}
          rating={review[fields.rating]}
          dateFinished={review[fields.dateFinished]}
          notes={review[fields.notes]}
          isReread={review[fields.isReread]}
          googleBooksId={review[fields.googleBooksId]![0]}
          awardTier={review[fields.awardTier]?.[0]}
          bookMedium={review[fields.medium]}
          seriesName={review[fields.seriesName]?.[0]}
          authors={review[fields.authorFullNames]}
        />
      ))
    }
  </div>
</Layout>
