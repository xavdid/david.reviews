---
import { Image } from "astro:assets";

import { loadInProgessPlays } from "../airtable/data/inProgressPlays";
import { loadInProgressReads } from "../airtable/data/inProgressReads";
import RssIcon from "../components/icons/rss.astro";
import ExternalLink from "../components/links/ExternalLink.astro";
import SubtleLink from "../components/links/SubtleLink.astro";
import Layout from "../layouts/Layout.astro";
import { seoTitle } from "../utils/data";
import SteamFollowButton from "../components/SteamFollowButton.astro";

const inProgressPlays = (await loadInProgessPlays()).toSorted(
  (a, b) =>
    new Date(b.dateStarted).valueOf() - new Date(a.dateStarted).valueOf(),
);

const inProgressReads = (await loadInProgressReads()).toSorted(
  (a, b) =>
    new Date(b.dateStarted).valueOf() - new Date(a.dateStarted).valueOf(),
);
---

<Layout
  pageTitle={`Home`}
  seoTitle={seoTitle("Games, Movies, and Books")}
  seoDescription={`Learn all about David's review site, where he shares his thoughts on the games he plays, the movies he watches, and the books he reads.`}
>
  <p class="py-2 pt-4">
    Welcome to <strong>david.reviews</strong>, my small, independent media
    review site. I'm <ExternalLink href="https://xavd.id">
      {"David"}
    </ExternalLink> and I've been doing this in some form or another since 2016.
  </p>

  <p class="pb-4 pt-2">
    The easiest way to keep up with my game reviews is to:
  </p>

  <SteamFollowButton />

  <p class="pb-4 pt-2">
    Alternatively, you can follow one of the many <SubtleLink
      href="/feeds"
      classes={["whitespace-nowrap"]}
    >
      <RssIcon classes={["inline", "mr-1"]} />{"RSS Feeds"}
    </SubtleLink> (which include all media types, plus articles).
  </p>

  <!-- <h2 class="py-3 text-center text-2xl underline">Recent Articles</h2> -->
  <!-- can include this, but /articles page does the same -->

  <h2 class="py-3 text-center text-2xl underline">Now Playing</h2>
  <div class="flex flex-wrap justify-around gap-y-2">
    {
      inProgressPlays.length === 0 && (
        <p>
          I'm not playing anything at the moment but I'll be starting something
          from my
          <ExternalLink href="https://airtable.com/appLZQMgewaSP7Gg3/shrajGTisjQqBwxLf/tbl0H4RdvzHEZWgdC">
            {"Play Next"}
          </ExternalLink>{" "}
          list (or the{" "}
          <ExternalLink href="https://airtable.com/appLZQMgewaSP7Gg3/shrMB1f0PQcfg1tnM/tbl0H4RdvzHEZWgdC">
            {"Play Soon"}
          </ExternalLink>
          list) shortly.
        </p>
      )
    }
    {
      inProgressPlays.map(
        ({ playType, dateStarted, game: { title, posterUrl } }) => (
          <div class="align-center flex w-full rounded border-2 border-blue-600 p-2">
            <Image
              class="max-w-[unset] py-1"
              src={posterUrl}
              alt={`poster for ${title}`}
              height={160}
              width={120}
            />
            <div class="flex flex-col pl-4">
              <span class="pb-2 text-xl font-bold">{title}</span>
              <span>since: {dateStarted}</span>
              <span>{playType}</span>
            </div>
          </div>
        ),
      )
    }
  </div>
  <h2 class="pb-3 pt-4 text-center text-2xl underline">Now Reading</h2>
  <div class="flex flex-wrap justify-around gap-y-2">
    {
      inProgressReads.length === 0 && (
        <p>
          I'm not reading anything at the moment but I'll be starting something
          from my
          <ExternalLink href="https://airtable.com/appv2mhWOgkRhR4rK/shrzRTbsZiBhVeugG">
            {"To Read"}
          </ExternalLink>{" "}
          list shortly.
        </p>
      )
    }
    {
      inProgressReads.map(
        ({ dateStarted, book: { title, posterUrl, authors }, medium }) => (
          <div class="align-center flex w-full rounded border-2 border-emerald-600 p-2">
            <Image
              class="max-w-[unset] py-1"
              src={posterUrl}
              alt={`poster for ${title}`}
              height={160}
              width={120}
            />
            <div class="flex flex-col pl-4">
              <span class="pb-2 text-xl font-bold">{title}</span>
              <span>by: {authors.map((a) => a.name).join(", ")}</span>
              <span>since: {dateStarted}</span>
              {medium === "Audio" && <span>{medium}</span>}
            </div>
          </div>
        ),
      )
    }
  </div>
</Layout>

<style></style>
